var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,n=(t,r,i)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,a=(e,a)=>{for(var s in a||(a={}))t.call(a,s)&&n(e,s,a[s]);if(r)for(var s of r(a))i.call(a,s)&&n(e,s,a[s]);return e};import{r as s,t as o,f as c,g as l,i as u,A as d,j as h,L as p,S as m,R as f,l as v,a as y,b,h as S,k as g,m as D,n as x,o as T,q as w,s as A,C as _,d as C,u as P,v as M,T as I,p as k,e as $}from"./index.11c20662.js";import"./vendor.1d43dcfd.js";function L(e,t){s(2,arguments);var r=o(e),i=o(t),n=r.getTime()-i.getTime();return n<0?-1:n>0?1:n}function R(e,t){s(2,arguments);var r=o(e),i=o(t),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return 12*n+a}function O(e,t){s(2,arguments);var r=o(e),i=o(t);return r.getTime()-i.getTime()}function F(e){s(1,arguments);var t=o(e);return t.setHours(23,59,59,999),t}function E(e){s(1,arguments);var t=o(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function B(e){s(1,arguments);var t=o(e);return F(t).getTime()===E(t).getTime()}function N(e,t){s(2,arguments);var r,i=o(e),n=o(t),a=L(i,n),c=Math.abs(R(i,n));if(c<1)r=0;else{1===i.getMonth()&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-a*c);var l=L(i,n)===-a;B(o(e))&&1===c&&1===L(e,n)&&(l=!1),r=a*(c-Number(l))}return 0===r?0:r}function j(e,t){s(2,arguments);var r=O(e,t)/1e3;return r>0?Math.floor(r):Math.ceil(r)}function J(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in t=t||{})t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e)}function U(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s(2,arguments);var i=r.locale||c;if(!i.formatDistance)throw new RangeError("locale must contain formatDistance property");var n=L(e,t);if(isNaN(n))throw new RangeError("Invalid time value");var a,u,d=J(r);d.addSuffix=Boolean(r.addSuffix),d.comparison=n,n>0?(a=o(t),u=o(e)):(a=o(e),u=o(t));var h,p=j(u,a),m=(l(u)-l(a))/1e3,f=Math.round((p-m)/60);if(f<2)return r.includeSeconds?p<5?i.formatDistance("lessThanXSeconds",5,d):p<10?i.formatDistance("lessThanXSeconds",10,d):p<20?i.formatDistance("lessThanXSeconds",20,d):p<40?i.formatDistance("halfAMinute",null,d):p<60?i.formatDistance("lessThanXMinutes",1,d):i.formatDistance("xMinutes",1,d):0===f?i.formatDistance("lessThanXMinutes",1,d):i.formatDistance("xMinutes",f,d);if(f<45)return i.formatDistance("xMinutes",f,d);if(f<90)return i.formatDistance("aboutXHours",1,d);if(f<1440){var v=Math.round(f/60);return i.formatDistance("aboutXHours",v,d)}if(f<2520)return i.formatDistance("xDays",1,d);if(f<43200){var y=Math.round(f/1440);return i.formatDistance("xDays",y,d)}if(f<86400)return h=Math.round(f/43200),i.formatDistance("aboutXMonths",h,d);if((h=N(u,a))<12){var b=Math.round(f/43200);return i.formatDistance("xMonths",b,d)}var S=h%12,g=Math.floor(h/12);return S<3?i.formatDistance("aboutXYears",g,d):S<9?i.formatDistance("overXYears",g,d):i.formatDistance("almostXYears",g+1,d)}
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const q=new WeakMap,X=u((e=>t=>{if(!(t instanceof d)||t instanceof h||"style"!==t.committer.name||t.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");const{committer:r}=t,{style:i}=r.element;let n=q.get(t);void 0===n&&(i.cssText=r.strings.join(" "),q.set(t,n=new Set)),n.forEach((t=>{t in e||(n.delete(t),-1===t.indexOf("-")?i[t]=null:i.removeProperty(t))}));for(const a in e)n.add(a),-1===a.indexOf("-")?i[a]=e[a]:i.setProperty(a,e[a])}));function V(e){return e*(Math.PI/180)}const z={"01":["38","73","74","39","71","69"],"02":["59","80","60","77","51","08"],"03":["42","71","58","18","23","63"],"04":["83","06","05","26","84","13"],"05":["04","26","38","73"],"06":["83","04"],"07":["48","30","84","26","38","69","43"],"08":["55","51","02","59"],"09":["31","11","66"],10:["89","21","52","51","77"],11:["09","31","81","34"],12:["34","30","48","15","46","82","81"],13:["30","84","83"],14:["27","61","50"],15:["48","43","63","19","46","12"],16:["17","79","86","87","24"],17:["85","79","16","33"],18:["36","41","45","89","58","03","23"],19:["23","87","24","46","15","63"],"2A":["2B"],"2B":["2A"],21:["10","89","58","71","39","70","52"],22:["29","56","35"],23:["87","19","63","03","18","36"],24:["17","16","87","19","46","47","33"],25:["39","70","90"],26:["84","04","05","38","69","07"],27:["76","60","95","78","28","61","14"],28:["27","78","91","45","41","72","61"],29:["22","56"],30:["34","12","48","07","26","84","13"],31:["65","32","82","81","11","09"],32:["31","65","64","40","47","82"],33:["17","24","47","40"],34:["11","81","12","30"],35:["50","53","49","44","56","22"],36:["37","41","18","23","87","86"],37:["41","36","86","49","72"],38:["05","73","01","69","07","26","05"],39:["01","71","21","70","25"],40:["33","47","32","64"],41:["72","37","36","18","45","28"],42:["43","69","71","03","63"],43:["48","07","69","42","63","15"],44:["56","35","53","49","85"],45:["91","77","28","41","18","58","89"],46:["15","19","24","47","82","12"],47:["33","40","32","82","46","24"],48:["12","30","07","43","15"],49:["44","53","72","37","86","79","85"],50:["14","61","53","35"],51:["02","77","10","52","55","08"],52:["21","70","88","55","51","10"],53:["49","72","61","50","35","44"],54:["57","67","88","55"],55:["54","88","52","51","08"],56:["29","22","35","44"],57:["67","88","54"],58:["03","71","21","89","45","18"],59:["02","80","62","08"],60:["02","80","76","27","95","77"],61:["14","27","28","72","53","50"],62:["80","59","02"],63:["15","43","42","03","23","19"],64:["40","32","65"],65:["64","32","31"],66:["09","11"],67:["68","88","54","57"],68:["90","70","88","67"],69:["01","71","42","43","07","26","38"],70:["21","39","25","90","88","52"],71:["03","42","69","01","39","21","58"],72:["28","61","53","49","37","41"],73:["74","01","38","05"],74:["73","01"],75:["92","93","94"],76:["80","60","27"],77:["89","10","51","02","60","93","91","45"],78:["95","27","28","91","92"],79:["17","85","49","86","16"],80:["62","59","02","60","76"],81:["11","34","12","82","31"],82:["32","31","81","12","46","47"],83:["13","84","04","06"],84:["13","04","26","07","30"],85:["44","49","79","17"],86:["36","37","49","79","16","87"],87:["23","19","24","16","86"],88:["70","90","68","67","57","54","55","52"],89:["58","21","10","77","45"],90:["25","70","88","68"],91:["45","28","77","78","92","94"],92:["75","95","78","93"],93:["92","95","94","77"],94:["77","75","92","93","91"],95:["78","27","60","93","92"],971:[],972:[],973:[],974:[],976:[],om:[]};function Y(e){return new Promise((t=>setTimeout(t,e)))}class H{constructor(e){this.array=e}concat(e){return this.array=this.array.concat(e),this}map(e){return new H(this.array.map(e))}filter(e){return this.array=this.array.filter(e),this}sort(e){return this.array.sort(e),this}sortBy(e){return this.sort(((t,r)=>e(t).localeCompare(e(r))))}build(){return this.array}static from(e){return new H(e)}}class G{ajouterCartesPaginees(e,t){if(!(null==e?void 0:e.lieuxAffichables)||t.length>=(null==e?void 0:e.lieuxAffichables.length))return t;const r=t.length;let i=e.lieuxAffichables.slice(r,r+20);return t.concat(i)}}var W=Object.defineProperty,K=Object.getOwnPropertyDescriptor,Q=(e,t,r,i)=>{for(var n,a=i>1?void 0:i?K(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i?n(t,r,a):n(a))||a);return i&&a&&W(t,r,a),a};class Z extends p{constructor(){super(...arguments),this.DELAI_VERIFICATION_MISE_A_JOUR=45e3,this.DELAI_VERIFICATION_SCROLL=1e3,this.SCROLL_OFFSET=200,this.lieuxParDepartementAffiches=void 0,this.searchInProgress=!1,this.miseAJourDisponible=!1,this.cartesAffichees=[],this.currentSearch=void 0,this.derniereCommuneSelectionnee=void 0,this.lieuBackgroundRefreshIntervalId=void 0,this.infiniteScroll=new G}get totalCreneaux(){return this.lieuxParDepartementAffiches?this.lieuxParDepartementAffiches.lieuxAffichables.reduce(((e,t)=>e+t.appointment_count),0):0}beforeNewSearchFromLocation(e){return e}async onSearchSelected(e){const t=e.detail;this.goToNewSearch(this.beforeNewSearchFromLocation(t))}async goToNewSearch(e){if(m.isByDepartement(e))f.navigateToRendezVousAvecDepartement(e.departement.code_departement,v(e.departement),e.type);else{const t=(await y.current.departementsDisponibles()).find((t=>t.code_departement===e.commune.codeDepartement)),r=e.commune;f.navigateToRendezVousAvecCommune(e.tri,r.codeDepartement,v(t),r.code,r.codePostal,b(r),e.type)}}render(){const e=this.lieuxParDepartementAffiches&&this.lieuxParDepartementAffiches.lieuxAffichables?this.lieuxParDepartementAffiches.lieuxAffichables.filter((e=>e.disponible)):[];return S`
            <div class="criteria-container text-dark rounded-3 py-5 ${g({"bg-std":m.isStandardType(this.currentSearch),"bg-highlighted":!m.isStandardType(this.currentSearch)})}">
              <div class="rdvForm-fields row align-items-center mb-3 mb-md-5">
                    <vmd-search
                          .value="${this.currentSearch}"
                          @on-search="${this.onSearchSelected}"
                        />
                </div>
                ${this.renderAdditionnalSearchCriteria()}
            </div>

            <div class="spacer mt-5 mb-5"></div>

            ${this.searchInProgress?S`
              <div class="d-flex justify-content-center">
                <div class="spinner-border text-primary" style="height: 50px; width: 50px" role="status">
                </div>
              </div>
            `:S`
                <h3 class="fw-normal text-center h4 ${g({"search-highlighted":!m.isStandardType(this.currentSearch),"search-standard":m.isStandardType(this.currentSearch)})}"
                    style="${X({display:this.lieuxParDepartementAffiches?"block":"none"})}">
                    ${this.totalCreneaux.toLocaleString()} créneau${D.plural(this.totalCreneaux,"x")} de vaccination trouvé${D.plural(this.totalCreneaux)}
                    ${this.libelleLieuSelectionne()}
                  <br/>
                  ${this.lieuxParDepartementAffiches&&this.lieuxParDepartementAffiches.derniereMiseAJour?S`
                      <p class="fs-6 text-gray-600">
                        Dernière mise à jour : il y a
                        ${function(e,t){return s(1,arguments),U(e,Date.now(),t)}(T(this.lieuxParDepartementAffiches.derniereMiseAJour),{locale:x})}
                        ${this.miseAJourDisponible?S`
                          <button class="btn btn-primary" @click="${()=>{this.refreshLieux(),this.miseAJourDisponible=!1,this.launchCheckingUpdates()}}">Rafraîchir</button>
                        `:S``}
                      </p>
                      <p class="alert alert-warning fs-6">
                          <i class="bi vmdicon-attention-fill"></i>
                          Les plateformes sont très sollicitées, les données affichées par Vite Ma Dose peuvent avoir jusqu'à 15 minutes de retard pour Doctolib.
                      </p>
                        `:S``}
                  </h3>

                <div class="spacer mt-5 mb-5"></div>
                <div class="resultats px-2 py-5 text-dark bg-light rounded-3">
                    ${e.length?S`
                        <h2 class="row align-items-center justify-content-center mb-5 h5 px-3">
                            <i class="bi vmdicon-calendar2-check-fill text-success me-2 fs-3 col-auto"></i>
                            <span class="col col-sm-auto">
                                ${e.length} Lieu${D.plural(e.length,"x")} de vaccination avec des disponibilités
                            </span>
                        </h2>
                    `:S`
                        <h2 class="row align-items-center justify-content-center mb-5 h5">
                          <i class="bi vmdicon-calendar-x-fill text-black-50 me-2 fs-3 col-auto"></i>
                          Aucun créneau de vaccination trouvé
                        </h2>
                        <div class="mb-5 container-content">
                          <p class="fst-italic">Nous n’avons pas trouvé de <strong>rendez-vous de vaccination</strong> Covid-19
                            sur les plateformes de réservation. </p>
                          <p class="fst-italic">Nous vous recommandons toutefois de vérifier manuellement
                            les rendez-vous de vaccination auprès des sites qui gèrent la réservation de créneau de vaccination.
                            Pour ce faire, cliquez sur le bouton “vérifier le centre de vaccination”.
                          </p>
                          <p class="fst-italic">Pour recevoir une notification quand de nouveaux créneaux seront disponibles,
                            nous vous invitons à utiliser les applications mobiles “Vite Ma Dose !” pour
                            <u><a href="https://play.google.com/store/apps/details?id=com.cvtracker.vmd2" target="_blank" rel="noopener">Android</a></u>
                            et <u><a href="http://apple.co/3dFMGy3" target="_blank" rel="noopener">iPhone</a></u>.
                          </p>
                        </div>
                    `}
                        <div id="scroller">
                            ${w(this.cartesAffichees||[],(e=>`${e.departement}||${e.nom}||${e.plateforme}}`),((e,t)=>S`<vmd-appointment-card
                                    style="--list-index: ${t}"
                                    .lieu="${e}"
                                    theme="${this.currentSearch?this.currentSearch.type:""}"
                                    @prise-rdv-cliquee="${e=>this.prendreRdv(e.detail.lieu)}"
                                    @verification-rdv-cliquee="${e=>this.verifierRdv(e.detail.lieu)}"
                                />`))}
                            <div id="sentinel"></div>
                        </div>
                ${m.isStandardType(this.currentSearch)?S`
                <div class="eligibility-criteria fade-in-then-fade-out">
                    <p>Les critères d'éligibilité sont vérifiés lors de la prise de rendez-vous</p>
                </div>`:S``}
            `}
        `}updated(e){super.updated(e),this.registerInfiniteScroll()}async connectedCallback(){super.connectedCallback(),this.launchCheckingUpdates()}registerInfiniteScroll(){if(!this.shadowRoot)return;const e=this.shadowRoot.querySelector("#scroller"),t=this.shadowRoot.querySelector("#sentinel");e&&t&&(this.infiniteScrollObserver&&this.infiniteScrollObserver.disconnect(),this.infiniteScrollObserver=new IntersectionObserver((e=>{e.some((e=>e.isIntersecting))&&(this.cartesAffichees=this.infiniteScroll.ajouterCartesPaginees(this.lieuxParDepartementAffiches,this.cartesAffichees))}),{root:null,rootMargin:"200px",threshold:0}),t&&this.infiniteScrollObserver.observe(t))}disconnectedCallback(){super.disconnectedCallback(),this.stopCheckingUpdates(),this.stopListeningToScroll()}stopCheckingUpdates(){this.lieuBackgroundRefreshIntervalId&&(clearInterval(this.lieuBackgroundRefreshIntervalId),this.lieuBackgroundRefreshIntervalId=void 0)}stopListeningToScroll(){this.infiniteScrollObserver&&this.infiniteScrollObserver.disconnect()}launchCheckingUpdates(){void 0===this.lieuBackgroundRefreshIntervalId&&(this.lieuBackgroundRefreshIntervalId=function(e,t,...r){let i=!1;return setInterval((async()=>{if(i)console.warn("Skipped setDebouncedInterval()'s handler as ongoing already");else try{i=!0,await e(...r)}finally{i=!1}}),t)}((async()=>{var e;const t=this.currentSearch;if(t){const r=m.isByDepartement(t)?t.departement.code_departement:t.commune.codeDepartement,i=null==(e=this.lieuxParDepartementAffiches)?void 0:e.derniereMiseAJour,n=await y.current.lieuxPour(r);this.miseAJourDisponible=i!==n.derniereMiseAJour,this.miseAJourDisponible&&this.stopCheckingUpdates(),await this.requestUpdate()}}),this.DELAI_VERIFICATION_MISE_A_JOUR))}async refreshLieux(){const e=this.currentSearch;if(e){const t=m.isByDepartement(e)?e.departement.code_departement:e.commune.codeDepartement;try{this.searchInProgress=!0,await Y(1);const[r,...i]=await Promise.all([y.current.lieuxPour(t),...this.codeDepartementAdditionnels(t).map((e=>y.current.lieuxPour(e)))]),n=[r].concat(i).reduce(((e,t)=>({codeDepartements:e.codeDepartements.concat(t.codeDepartements),derniereMiseAJour:e.derniereMiseAJour,lieuxDisponibles:e.lieuxDisponibles.concat(t.lieuxDisponibles),lieuxIndisponibles:e.lieuxIndisponibles.concat(t.lieuxIndisponibles)})),{codeDepartements:[],derniereMiseAJour:r.derniereMiseAJour,lieuxDisponibles:[],lieuxIndisponibles:[]});this.lieuxParDepartementAffiches=this.afficherLieuxParDepartement(n,e),this.cartesAffichees=this.infiniteScroll.ajouterCartesPaginees(this.lieuxParDepartementAffiches,[]);const a=m.isByCommune(e)?e.commune:void 0;A.INSTANCE.rechercheLieuEffectuee(t,this.currentCritereTri(),e.type,a,this.lieuxParDepartementAffiches)}finally{this.searchInProgress=!1}}else this.lieuxParDepartementAffiches=void 0,this.cartesAffichees=[]}prendreRdv(e){this.currentSearch&&m.isByCommune(this.currentSearch)&&e.url&&A.INSTANCE.clickSurRdv(e,this.currentCritereTri(),this.currentSearch.type,this.currentSearch.commune),f.navigateToUrlIfPossible(e.url)}verifierRdv(e){this.currentSearch&&m.isByCommune(this.currentSearch)&&e.url&&A.INSTANCE.clickSurVerifRdv(e,this.currentCritereTri(),this.currentSearch.type,this.currentSearch.commune),f.navigateToUrlIfPossible(e.url)}renderAdditionnalSearchCriteria(){return S``}extraireFormuleDeTri(e,t){if("date"===t){let t;return t=e.appointment_by_phone_only&&e.metadata.phone_number?2:e.url?0!==e.appointment_count?null!==e.prochain_rdv?0:1:3:4,`${t}__${D.padLeft(Date.parse(e.prochain_rdv)||0,15,"0")}`}if("distance"===t){let t;return t=e.appointment_by_phone_only&&e.metadata.phone_number||e.url&&0!==e.appointment_count?0:1,`${t}__${D.padLeft(Math.round(1e3*e.distance),8,"0")}`}throw new Error(`Unsupported tri : ${t}`)}updateSearchTypeTo(e){this.currentSearch&&this.goToNewSearch(a(a({},this.currentSearch),{type:e}))}transformLieuEnFonctionDuTypeDeRecherche(e){return e}}Z.styles=[_,C`${P(".rdvForm-fields {\n  max-width: 75vw;\n  margin: auto;\n}\n@media (min-width: 1200px) {\n  .rdvForm-fields {\n    max-width: 65vw;\n  }\n}\n@media (min-width: 768px) {\n  .rdvForm-fields label, .rdvForm-fields select, .rdvForm-fields input {\n    font-size: 2.4rem;\n  }\n}\n.eligibility-criteria {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  color: #b02a37;\n  width: 100%;\n  background-color: #f8d7da;\n  text-align: center;\n  vertical-align: center;\n}\n.eligibility-criteria p {\n  margin: 0.5em;\n}\n.fade-in-then-fade-out {\n  -webkit-animation-name: fade-in-then-fade-out;\n          animation-name: fade-in-then-fade-out;\n  -webkit-animation-duration: 10s;\n          animation-duration: 10s;\n  -webkit-animation-fill-mode: forwards;\n          animation-fill-mode: forwards;\n}\n@-webkit-keyframes fade-in-then-fade-out {\n  0%, 100% {\n    opacity: 0;\n  }\n  10%, 90% {\n    opacity: 1;\n  }\n}\n@keyframes fade-in-then-fade-out {\n  0%, 100% {\n    opacity: 0;\n  }\n  10%, 90% {\n    opacity: 1;\n  }\n}\nvmd-appointment-card {\n  display: block;\n  opacity: 1;\n  -webkit-animation: fade-in ease-in 200ms;\n          animation: fade-in ease-in 200ms;\n  -webkit-animation-fill-mode: backwards;\n          animation-fill-mode: backwards;\n  -webkit-animation-delay: calc((var(--page-index) * 60ms) + 50ms);\n          animation-delay: calc((var(--page-index) * 60ms) + 50ms);\n}\n@-webkit-keyframes fade-in {\n  from {\n    opacity: 0;\n    filter: saturate(0%);\n  }\n  to {\n    opacity: 1;\n    filter: saturate(100%);\n  }\n}\n@keyframes fade-in {\n  from {\n    opacity: 0;\n    filter: saturate(0%);\n  }\n  to {\n    opacity: 1;\n    filter: saturate(100%);\n  }\n}\n.criteria-container.search-standard {\n  background-color: #e6e7f9;\n}\n.criteria-container.search-highlighted {\n  background-color: #fdeeef;\n}\n.container-content {\n  max-width: 80vw;\n  margin: 0 auto;\n}\n@media (min-width: 1200px) {\n  .container-content {\n    max-width: 65vw;\n  }\n}")}`,C`
        `],Q([k({type:Array,attribute:!1})],Z.prototype,"lieuxParDepartementAffiches",2),Q([k({type:Boolean,attribute:!1})],Z.prototype,"searchInProgress",2),Q([k({type:Boolean,attribute:!1})],Z.prototype,"miseAJourDisponible",2),Q([k({type:Array,attribute:!1})],Z.prototype,"cartesAffichees",2),Q([M()],Z.prototype,"currentSearch",2);let ee=class extends Z{constructor(){super(...arguments),this.currentSearch=void 0,this._searchType=void 0,this._codeCommuneSelectionne=void 0,this._codePostalSelectionne=void 0,this._critèreDeTri="distance",this.currentSearchMarker={}}set searchType(e){this._searchType=e,this.updateCurrentSearch()}set codeCommuneSelectionne(e){this._codeCommuneSelectionne=e,this.updateCurrentSearch()}set codePostalSelectionne(e){this._codePostalSelectionne=e,this.updateCurrentSearch()}set"critèreDeTri"(e){this._critèreDeTri=e,this.updateCurrentSearch()}async updateCurrentSearch(){if(this._codeCommuneSelectionne&&this._codePostalSelectionne&&this._critèreDeTri&&this._searchType){const e={};if(this.currentSearchMarker=e,await Y(20),this.currentSearchMarker!==e)return;const t=await y.current.autocomplete.findCommune(this._codePostalSelectionne,this._codeCommuneSelectionne);t&&(this.currentSearch=m.ByCommune(t,this._critèreDeTri,this._searchType),this.refreshLieux())}}codeDepartementAdditionnels(e){return z[e]}libelleLieuSelectionne(){let e="???";if(this.currentSearch){const t=this.currentSearch.commune;e=`${t.nom} (${t.codePostal})`}return S`
          autour de
          <span class="fw-bold">${e}</span>
        `}afficherLieuxParDepartement(e,t){const r=t.commune,i=e=>e.location?function({latitude:e,longitude:t},{latitude:r,longitude:i}){var n=V(r-e),a=V(i-t),s=Math.sin(n/2)*Math.sin(n/2)+Math.cos(V(e))*Math.cos(V(r))*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371}(r,e.location):1/0,{lieuxDisponibles:n,lieuxIndisponibles:s}=e;return a(a({},e),{lieuxAffichables:H.from([...n].map((e=>a(a({},e),{disponible:!0})))).concat([...s].map((e=>a(a({},e),{disponible:!1})))).map((e=>a(a({},e),{distance:i(e)}))).map((e=>this.transformLieuEnFonctionDuTypeDeRecherche(e))).filter((e=>!e.distance||e.distance<100)).sortBy((e=>this.extraireFormuleDeTri(e,t.tri))).build()})}critereTriUpdated(e){if(A.INSTANCE.critereTriCentresMisAJour(e),this.currentSearch){const t=a(a({},this.currentSearch),{tri:e});this.goToNewSearch(t)}}beforeNewSearchFromLocation(e){return m.isByCommune(e)&&this.currentSearch?a(a({},e),{tri:this.currentSearch.tri}):e}renderAdditionnalSearchCriteria(){return m.isStandardType(this.currentSearch)?S`
          <div class="rdvForm-fields row align-items-center">
            <label class="col-sm-24 col-md-auto mb-md-3">
              Je recherche une dose de vaccin :
            </label>
            <div class="col">
              <vmd-button-switch class="mb-3"
                     codeSelectionne="${this._critèreDeTri}"
                     .options="${Array.from(I.values()).map((e=>({code:e.codeTriCentre,libelle:e.libelle})))}"
                     @changed="${e=>this.critereTriUpdated(e.detail.value)}">
              </vmd-button-switch>
            </div>
          </div>
        `:S``}currentCritereTri(){return this.critèreDeTri}};Q([M()],ee.prototype,"currentSearch",2),Q([k({type:String})],ee.prototype,"searchType",1),Q([k({type:String})],ee.prototype,"codeCommuneSelectionne",1),Q([k({type:String})],ee.prototype,"codePostalSelectionne",1),Q([k({type:String})],ee.prototype,"critèreDeTri",1),Q([M()],ee.prototype,"_searchType",2),Q([M()],ee.prototype,"_codeCommuneSelectionne",2),Q([M()],ee.prototype,"_codePostalSelectionne",2),Q([M()],ee.prototype,"_critèreDeTri",2),ee=Q([$("vmd-rdv-par-commune")],ee);let te=class extends Z{constructor(){super(...arguments),this._searchType=void 0,this._codeDepartement=void 0,this.currentSearch=void 0}set searchType(e){this._searchType=e,this.updateCurrentSearch()}set codeDepartementSelectionne(e){this._codeDepartement=e,this.updateCurrentSearch()}async updateCurrentSearch(){const e=this._codeDepartement;if(e&&this._searchType){const t=(await y.current.departementsDisponibles()).find((t=>t.code_departement===e));t&&(this.currentSearch=m.ByDepartement(t,this._searchType),this.refreshLieux())}}codeDepartementAdditionnels(){return[]}libelleLieuSelectionne(){let e="???";if(this.currentSearch){const t=this.currentSearch.departement;e=`${t.nom_departement} (${t.code_departement})`}return S`
          pour
          <span class="fw-bold">${e}</span>
        `}afficherLieuxParDepartement(e){const{lieuxDisponibles:t,lieuxIndisponibles:r}=e;return a(a({},e),{lieuxAffichables:H.from([...t].map((e=>a(a({},e),{disponible:!0})))).concat([...r].map((e=>a(a({},e),{disponible:!1})))).map((e=>a(a({},e),{distance:void 0}))).map((e=>this.transformLieuEnFonctionDuTypeDeRecherche(e))).sortBy((e=>this.extraireFormuleDeTri(e,"date"))).build()})}currentCritereTri(){return"date"}};Q([k({type:String})],te.prototype,"searchType",1),Q([k({type:String})],te.prototype,"codeDepartementSelectionne",1),Q([M()],te.prototype,"_searchType",2),Q([M()],te.prototype,"_codeDepartement",2),Q([M()],te.prototype,"currentSearch",2),te=Q([$("vmd-rdv-par-departement")],te);export{Z as AbstractVmdRdvView,ee as VmdRdvParCommuneView,te as VmdRdvParDepartementView};
